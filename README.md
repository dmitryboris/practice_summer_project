# Трансформер для регрессии по временным рядам. Анализ свечей Мосбиржи

## 1. Dataset

Был выбран датасет RUSSIA 249 Stocks Prices MOEX

Ссылка: https://www.kaggle.com/datasets/olegshpagin/russia-stocks-prices-ohlcv

Датасет предоставляет исторические цены открытия, максимума, минимума, закрытия и объема (OHLCV) акций, торгуемых на российских финансовых рынках MOEX.

Все данные разбиты на 7-часовые торговые сессии. Признаки - это первые 6 свеч, а целевая переменная - close 7-ой свечи.

Датасет разбит на три выборки (train/test/val)

Train: 39 акций, 810957 свечей

Val:   39 акций, 115689 свечей

Test:  39 акций, 231532 свечей


## 1.1 Normalise

Данные необходимо нормализовать, так как цены на акциий рахных компаний могут сильно разниться.

Например, акции ВТБ торгуются по цене меньше 100 рублей, а акции Лукойла около 6000 рублей.
Можно использовать z-нормализацию по каждой акции за весь доступный период, но за 10 лет цены на акции выросли. Нормализация с mean/std, посчитанными за 10 лет, в задачах регрессии по ценам может ввести сильное искажение. Все современные цены окажутся смещёнными вверх, хотя они уже давно не аномалии, а норма. 

Нормализация данных по каждой акции в рамках одной торговой сессии, либо в рамках последнего месяца/года должна подходить лучше, но привела к неконтроилруемым выбросам. Идею нужно развивать

Признак объема (Volume) логарифмируется.

## Loss

Для этой задачи могут подойти MSE, MAE, Huber, MSLE или log-cosh. Был выбран Huber. По MAE и MSE будет только оцениваться результат на тестовой выборке.

## Model

Трансформер на основе Encoder, принимает на вход (open, high, low, close, log_volume)


## Train

![train](https://github.com/dmitryboris/practice_summer_project/blob/main/train.png)

## Test

Test Loss (SmoothL1): 0.000131

MAE: 3.5467, MSE: 140.8644

## Test on SBER today

При использовании std/mean по всей истории Сбербанка, предсказание модели 325.38 рублей

При использвании std/mean свечей за 17.07, предасказание модели 325.79 рублей

Настоящий close 326.00 рублей
